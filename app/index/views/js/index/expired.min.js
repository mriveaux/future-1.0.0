
Ext.QuickTips.init();lMask.hide();MensajeInformacion("Su sesi&oacute;n ha expirado. Vuelva a ingresar sus credenciales.");var usertmp,identidad,identidad_padre,desc_entidad;var regexuser=/^[ a-zA-Z0-9\.\_\-\@]$/,regexpass=/^[ a-zA-Z0-9\.\,\;\#\*\/\-\+]$/;function mostrarEntidades(){var b=new Ext.data.JsonStore({autoLoad:true,url:"futureauthloadentities",fields:["identidad","nombre","foto","idpadre"],listeners:{load:function(f,d,e){if(d.length===1){identidad=d[0].data.identidad;identidad_padre=d[0].data.idpadre;desc_entidad=d[0].data.nombre;Ext.getCmp("btnEntAceptar").handler().call()}}}});var c=new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap" id="{identidad}">','<div class="thumb"><img src="data:image/jpg;base64,{foto}" title="{nombre}"></div>','<span class="x-editable">{shortName}</span></div>',"</tpl>",'<div class="x-clear"></div>');var a=new Ext.Panel({id:"images-view",frame:true,width:535,height:310,autoScroll:true,layout:"fit",buttonAlign:"center",title:"Desglose de entidades autorizadas",items:new Ext.DataView({store:b,tpl:c,singleSelect:true,loadingText:"Cargando...",overClass:"x-view-over",itemSelector:"div.thumb-wrap",emptyText:"Ninguna imagen que mostrar.",prepareData:function(d){d.shortName=Ext.util.Format.ellipsis(d.nombre,15);return d},listeners:{click:{fn:function(g,f,h,i){var d=g.getRecord(h);identidad=d.data.identidad;identidad_padre=d.data.idpadre;desc_entidad=d.data.nombre;Ext.getCmp("btnEntAceptar").enable();a.setTitle("Acceder al sistema por: "+d.data.nombre)}},containerclick:{fn:function(d,f){Ext.getCmp("btnEntAceptar").disable();a.setTitle("Desglose de entidades autorizadas")}},dblclick:{fn:function(g,f,h,i){var d=g.getRecord(h);identidad=d.data.identidad;identidad_padre=d.data.idpadre;desc_entidad=d.data.nombre;a.setTitle("Acceder al sistema por: "+d.data.nombre);Ext.getCmp("btnEntAceptar").handler.call()}}}}),buttons:[{text:'<i class="fa fa-sign-out fa-flip-horizontal primary blue-stripe-left"></i> Atr&aacute;s',id:"btnEntAtras",handler:function(){loadMask("Recargando la sesi&oacute;n...");Ext.getCmp("images-view").destroy();window.location.reload()}},{text:'<i class="loading-btn fa fa-sign-in primary blue-stripe-right"></i> Aceptar',disabled:true,id:"btnEntAceptar",handler:openWorkSpace}]});Ext.get("login").remove();a.render("formIndex")}function verificarDatos(b,a){MostrarBarraProgreso("Verificando credenciales...");Ext.Ajax.request({url:"futureauthservice_loggin_",method:"POST",params:{usuario:b,password:hex_md5(a)},callback:function(d,f,c){var e=Ext.decode(c.responseText);Ext.MessageBox.hide();switch(parseInt(e)){case 0:MensajeError("Los datos de entrada no son v&aacute;lidos.");Ext.get("loginuser").dom.value="";Ext.get("loginpass").dom.value="";Ext.get("loginuser").focus();break;case 1:MensajeError("El usuario se encuentra desactivado temporalmente.");Ext.get("loginuser").dom.value="";Ext.get("loginpass").dom.value="";break;case 2:MensajeError("El usuario no puede acceder al sistema desde<br>la direcci&oacute;n IP actual.");Ext.get("loginuser").dom.value="";Ext.get("loginpass").dom.value="";break;case 3:mostrarEntidades();break;case 4:MensajeError("En estos momentos el servidor LDAP no est&aacute; disponible.");break;default:MensajeError("Ha ocurrido un error mientras se realizaba esta operaci&oacute;n. Recargue nuevamente y vuelva a intentar.");break}}})}function openWorkSpace(){loadMask("Cargando datos de la entidad...");Ext.Ajax.request({url:"futureauthsetentity",method:"POST",params:{identidad:identidad,identidad_padre:identidad_padre,desc_entidad:desc_entidad},callback:function(b,c,a){if(window.parent.perfil){window.location=window.parent.perfil.currentPath}else{MensajeInformacion("No se ha podido comprobar los datos correctamente. Vuelva a la p&aacute;gina de inicio del sistema  e intente borrar el historial y los datos de la sesi&oacute;n")}}})}function validarCampos(){if(Ext.get("loginuser").dom.value!=""&&Ext.get("loginpass").dom.value!=""){verificarDatos(Ext.get("loginuser").dom.value,Ext.get("loginpass").dom.value)}else{if(Ext.get("loginuser").dom.value==""){Ext.get("loginuser").setStyle({"border-color":"#FF0000","box-shadow":"0 1px 1px rgba(255, 0, 0, 0.075) inset, 0 0 5px rgba(255, 0, 0, 0.6)"});Ext.get("loginuser").focus()}else{if(Ext.get("loginpass").dom.value==""){Ext.get("loginpass").setStyle({"border-color":"#FF0000","box-shadow":"0 1px 1px rgba(255, 0, 0, 0.075) inset, 0 0 5px rgba(255, 0, 0, 0.6)"});Ext.get("loginpass").focus()}}}}function quitInvalid(a){if(Ext.get(a).dom.value!=""){Ext.get(a).setStyle({"border-color":"#5599bb"})}else{Ext.get(a).setStyle({"border-color":"#FF0000","box-shadow":"0 1px 1px rgba(255, 0, 0, 0.075) inset, 0 0 5px rgba(255, 0, 0, 0.6)"})}}function validaCaracteres(a,b){if(b.test(String.fromCharCode(a))==false){return false}return true}function maskReg(b,a){return validaCaracteres(b,a)}Ext.onReady(function(){jQuery(document).ready(function(){Ext.get("loginuser").focus();$(".loading-btn").click(function(){var a=$(this);a.html('<i class="fa fa-spinner fa-pulse fa-fw primary"></i> Cargando...');setTimeout(function(){a.text("Acceder")},5000)})});(function(){var b=loadXML("/comun/comun/xml/system.xml");Ext.enviroment=b.getElementsByTagName("var")[0].childNodes[0].nodeValue;Ext.firebug=b.getElementsByTagName("firebug")[0].childNodes[0].nodeValue;if(Ext.enviroment=="prod"&&typeof(console)=="object"&&parseInt(Ext.firebug)!==1){var a="El complemento de desarrollo web <b>FIREBUG</b> est\xE1 instalado.";a+="\nDebe desinstalarlo para poder usarlo en el ambiente de PRODUCCI\xD3N.";Ext.Msg.show({title:"Advertencia",buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING,msg:a,fn:function(){window.location="about:blank"}})}})()});