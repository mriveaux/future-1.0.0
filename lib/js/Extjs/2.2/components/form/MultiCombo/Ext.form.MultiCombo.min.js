
if(!Ext.form){Ext.namespace("Ext.form")}Ext.form.MultiCombo=Ext.extend(Ext.form.ComboBox,{constructor:function(b){this.listHeight=150;this.singleSelection=false;this.leafSelect=true;this.allowBlank=false;this.forceSelection=true;this.typeAhead=true;this.enableKeyEvents=true;this.lazyRender=true;this.busyRequest=false;this.hideBbar=false;this.hideTbar=false;this.xtype="linkedcombo";this.fieldLabel="Nombre";this.mode="local";this.triggerAction="all";this.anchor="100%";this.selectedClass="";this.emptyText="Seleccione...";this.blankText="Este campo es obligatorio.";this.onSelect=Ext.emptyFn;this.customvalues=[];this.values=[];this.buttons=[];this.addEvents("beforeload","load","loadexception");if(!this.id){var a=Ext.DomQuery.select("div[id*=mcombo]");this.idtpl="mcombo"+(a.length+1)}else{this.idtpl="mcombo"+this.id}this.tpl='<tpl for="."><div id = "'+this.idtpl+'" style = "height:'+b.listHeight+'px; !important;"></div></tpl>';this.store=new Ext.data.SimpleStore({fields:[],data:[[]]});if(b.store){this.url=b.store.url}else{console.log("No se ha definido un store de datos")}this.multiselect=undefined;this.panel=undefined;Ext.apply(this,b||{});this.loadJs("/comun/Extjs/2.2/ext/Ext.form.SearchField.min","SearchField",function(){this.initCmp();this.initEvents()});return Ext.form.MultiCombo.superclass.constructor.call(this)},initCmp:function(){var a=this;a.multiselect=new Ext.form.MultiSelect({store:a.store,xtype:"multiselect",name:"multiselect",valueField:a.valueField,displayField:a.displayField,allowBlank:a.allowBlank,listeners:{change:function(c,f,e,b,d){a.setValue(f,e);if(c.hasValues()){a.fireEvent("select",a,{data:c.view.store.getAt(b)},b)}}}});a.panel=new Ext.form.FormPanel({layout:"fit",autoScroll:true,tbar:a.toolBarTop=new Ext.Toolbar({hidden:a.hideTbar,items:[this.btnSeleccionar=new Ext.Button({text:'<i class="fa fa-check-square-o" style="color: blue"></i> Seleccionar todo',tooltip:"Seleccionar todos",disabled:false,scope:this,handler:function(){this.btnSeleccionar.disable();this.btnDescartar.show();this.btnDescartar.enable();a.setAll(a.valueField,a.displayField)}}),this.btnDescartar=new Ext.Button({text:'<i class="fa fa-minus-square-o" style="color: red"></i> Descartar',tooltip:"Descartar selecci&oacute;n",disabled:true,hidden:true,scope:this,handler:function(){this.btnDescartar.disable();this.btnDescartar.hide();this.btnSeleccionar.enable();a.reset()}})]}),bbar:a.toolBarBottom=new Ext.Toolbar({hidden:a.hideBbar,items:[a.sfBuscar=new Ext.form.SearchField({enableKeyEvents:true,fnOnSearch:function(){a.multiselect.store.filter(a.displayField,a.sfBuscar.getValue());a.panel.add(a.multiselect);a.panel.fireEvent("render",a.panel);a.panel.doLayout()},fnOnClear:function(){a.multiselect.store.filter(a.displayField,"")},listeners:{keyup:function(b){if(b.getValue()){this.fnOnSearch()}}}})]}),items:[a.multiselect]})},initEvents:function(){var a=this;this.on({scope:a,expand:function(b){this.panel.setHeight(this.listHeight);loadMask("Espere, por favor...");this.sfBuscar.setWidth(this.getSize().width+10);if(!this.panel.rendered){this.multiselect.height=this.listHeight+30;this.multiselect.width=this.getSize().width+12;this.panel.render(this.idtpl);this.panel.doLayout()}lMask.hide()}})},getValues:function(){if(this.customvalues.length==1){this.values=(this.singleSelection==true)?this.customvalues[0]:this.customvalues[0].toString().split(",")}else{if(this.customvalues[0].length>0){this.values=(this.singleSelection==true)?this.customvalues[0]:this.customvalues}else{this.values=[]}}return this.values},getValue:function(){if(this.customvalues.length){return(this.singleSelection)?this.customvalues[0]:this.customvalues}else{return""}},setValue:function(c,d){this.customvalues=Ext.isArray(c)?c:[c];if(d){d=Ext.isArray(d)?d.join(", "):d;Ext.form.MultiCombo.superclass.setValue.call(this,d)}else{var b=this.store.find(this.valueField,c);var e=Ext.isArray(c)?c.join(", "):c;if(b!==-1){var a=this.store.getAt(b);e=a.data[this.displayField];if(this.displayField==""){e="";c=""}}else{if(d===undefined){e="";c=""}}Ext.form.MultiCombo.superclass.setValue.call(this,e)}},loadJs:function(e,d,c){var a=this;if(e!=null){var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("id",d);b.setAttribute("src",e+".js");b.onload=function(){if(typeof c==="function"){c.apply(a)}};Ext.DomQuery.selectNode("body").appendChild(b)}},loadCss:function(b){var a=document.createElement("style");a.type="text/css";if(a.styleSheet){a.styleSheet.cssText=b}else{a.appendChild(document.createTextNode(b))}document.getElementsByTagName("head")[0].appendChild(a)},reset:function(){this.multiselect.reset();Ext.form.MultiCombo.superclass.reset.call(this)},setAll:function name(a,e,c){var g=this;var d=c||this.store;var b=d.collect(a,false,true);var f=d.collect(e,false,true);this.customvalues=Ext.isArray(b)?b:[b];Ext.form.MultiCombo.superclass.setValue.call(this,f);this.multiselect.setValue(b);g.multiselect.fireEvent("change",g.multiselect,b,f,-1)}});Ext.reg("multicombo",Ext.form.MultiCombo);